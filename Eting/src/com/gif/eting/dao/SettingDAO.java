package com.gif.eting.dao;

import java.util.ArrayList;
import java.util.List;

import android.content.ContentValues;
import android.content.Context;
import android.database.Cursor;
import android.database.SQLException;
import android.database.sqlite.SQLiteDatabase;

import com.gif.eting.db.SettingDBHelper;
import com.gif.eting.dto.SettingDTO;

/**
 * 설정값에 대한 정보를 읽고/쓰는 객체. DataAccessObject. 
 *
 * @author lifenjoy51
 *
 */
public class SettingDAO {

	/**
	 *  Database fields
	 */
	private SQLiteDatabase database;
	private SettingDBHelper dbHelper;
	private String[] allColumns = { SettingDBHelper.COL_KEY,
			SettingDBHelper.COL_VALUE };

	/**
	 *  생성할때 dbHelper 초기화
	 * @param context
	 */
	public SettingDAO(Context context) {
		dbHelper = new SettingDBHelper(context);
	}

	/**
	 *  쓰기전에 open해주고
	 * @throws SQLException
	 */
	public void open() throws SQLException {
		database = dbHelper.getWritableDatabase();
	}

	/**
	 *  다쓰면 close한다
	 */
	public void close() {
		dbHelper.close();
	}

	/**
	 *  setting 리스팅
	 * @return
	 */
	public List<SettingDTO> getsettingList() {
		List<SettingDTO> settingList = new ArrayList<SettingDTO>();

		Cursor cursor = database.query(SettingDBHelper.TABLE_SETTING,
				allColumns, null, null, null, null, null);

		cursor.moveToFirst();
		while (!cursor.isAfterLast()) {
			SettingDTO setting = getSettingDTO(cursor);
			settingList.add(setting);
			cursor.moveToNext();
		}
		// Make sure to close the cursor
		cursor.close();

		return settingList;
	}

	/**
	 *  setting 한개 가져오기
	 * @param key
	 * @return
	 */
	public SettingDTO getsettingInfo(String key) {
		Cursor cur = database.query(SettingDBHelper.TABLE_SETTING, allColumns,
				SettingDBHelper.COL_KEY + " = " + "'"+key+"'", null, null, null, null);
		cur.moveToFirst(); // 커서 처음으로

		SettingDTO returnedsetting = getSettingDTO(cur); // 반환할 객체
		cur.close();
		
		if(returnedsetting!=null){
			//Log.i("setting info", returnedsetting.toString());
		}else{
			return null;
		}

		return returnedsetting;
	}

	/**
	 *  setting 입력
	 */
	public Long inssetting(SettingDTO setting) {
		ContentValues values = new ContentValues();
		values.put(SettingDBHelper.COL_KEY, setting.getKey());
		values.put(SettingDBHelper.COL_VALUE, setting.getValue());
		long insertedId = database.insert(SettingDBHelper.TABLE_SETTING, null,
				values);
		//Log.i("setting is inserted", String.valueOf(insertedId));

		return insertedId;
	}

	/**
	 *  setting 수정
	 * @param setting
	 * @return
	 */
	public Integer updsetting(SettingDTO setting) {
		String key = setting.getKey();
		ContentValues values = new ContentValues();
		values.put(SettingDBHelper.COL_VALUE, setting.getValue());
		int rtn = database.update(SettingDBHelper.TABLE_SETTING, values,
				SettingDBHelper.COL_KEY + " = " + "'"+key+"'", null);
		//Log.i("setting is updated", String.valueOf(rtn));

		return rtn;
	}

	/**
	 *  setting 삭제
	 * @param key
	 * @return
	 */
	public Integer delsetting(String key) {
		int rtn = database.delete(SettingDBHelper.TABLE_SETTING,
				SettingDBHelper.COL_KEY + " = " + "'"+key+"'", null);
		//Log.i("setting is deleted", String.valueOf(rtn));
		return rtn;
	}

	/**
	 *  커서에서 DTO받아오기
	 * @param cursor
	 * @return
	 */
	private SettingDTO getSettingDTO(Cursor cursor) {
		if (cursor!=null && cursor.getCount()>0) {
			SettingDTO setting = new SettingDTO(); // 객체 초기화
			setting.setKey(cursor.getString(0));
			setting.setValue(cursor.getString(1));
			return setting;

		} else {
			return null;
		}
	}
}
